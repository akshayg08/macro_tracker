<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macro Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: #f8fafc;
            min-height: 100vh;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fadeIn 0.4s ease-out;
        }
        .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .card-shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // STARTER FOOD DATABASE - Edit this to change default foods for all users
        const STARTER_FOODS = [
            { name: "Fage Yogurt", calories: 80, protein: 16, fat: 0, carb: 5, dietryFiber: 0, saturatedFat: 0 },
            { name: "Cheese Office", calories: 80, protein: 6, fat: 6, carb: 1, dietryFiber: 0, saturatedFat: 3 },
            { name: "Bread", calories: 40, protein: 4, fat: 1.5, carb: 9, dietryFiber: 8, saturatedFat: 0 },
            { name: "Guacamole", calories: 90, protein: 1, fat: 8, carb: 6, dietryFiber: 4, saturatedFat: 1 },
            { name: "Tortilla", calories: 60, protein: 5, fat: 3.5, carb: 20, dietryFiber: 18, saturatedFat: 1.5 },
            { name: "Paneer", calories: 90, protein: 7, fat: 7, carb: 1, dietryFiber: 0, saturatedFat: 4.5 },
            { name: "Veggies", calories: 45, protein: 1, fat: 2.5, carb: 5, dietryFiber: 2, saturatedFat: 0 },
            { name: "Broccli", calories: 25, protein: 0, fat: 0, carb: 5, dietryFiber: 3, saturatedFat: 0 },
            { name: "Strawberry Pouc", calories: 40, protein: 0, fat: 0, carb: 9, dietryFiber: 2, saturatedFat: 0 },
            { name: "Milk 1%", calories: 120, protein: 10, fat: 2.5, carb: 15, dietryFiber: 0, saturatedFat: 1.5 },
            { name: "Milk 2%", calories: 140, protein: 10, fat: 5, carb: 14, dietryFiber: 9, saturatedFat: 3 },
            { name: "Salsa", calories: 10, protein: 0, fat: 0, carb: 2, dietryFiber: 0, saturatedFat: 0 },
            { name: "Biscuit", calories: 230, protein: 3, fat: 9, carb: 36, dietryFiber: 3, saturatedFat: 1.5 },
            { name: "Bagel Plain", calories: 110, protein: 15, fat: 3, carb: 35, dietryFiber: 30, saturatedFat: 0 },
            { name: "Bagel Everything", calories: 140, protein: 15, fat: 5, carb: 36, dietryFiber: 30, saturatedFat: 0.5 },
            { name: "Cheese Home", calories: 60, protein: 7, fat: 3, carb: 0, dietryFiber: 0, saturatedFat: 2 },
            { name: "Dal", calories: 350, protein: 25, fat: 1, carb: 60, dietryFiber: 25, saturatedFat: 0 },
            { name: "cream cheese", calories: 80, protein: 0, fat: 7, carb: 2, dietryFiber: 0, saturatedFat: 6 },
            { name: "Protein Bar", calories: 180, protein: 21, fat: 7, carb: 23, dietryFiber: 12, saturatedFat: 2.5 },
            { name: "Sweetgreen", calories: 220, protein: 15, fat: 0, carb: 0, dietryFiber: 0, saturatedFat: 0 },
            { name: "Pasta", calories: 190, protein: 10, fat: 1, carb: 38, dietryFiber: 5, saturatedFat: 0 },
            { name: "pasta sauce", calories: 60, protein: 2, fat: 1, carb: 11, dietryFiber: 2, saturatedFat: 0 },
            { name: "Marie Biscuits", calories: 150, protein: 3, fat: 4, carb: 25, dietryFiber: 9, saturatedFat: 2 },
            { name: "Tofu", calories: 70, protein: 7, fat: 4, carb: 2, dietryFiber: 1, saturatedFat: 0.5 },
            { name: "spinach", calories: 20, protein: 3, fat: 0, carb: 3, dietryFiber: 2, saturatedFat: 0 },
            { name: "rice", calories: 160, protein: 4, fat: 0.5, carb: 36, dietryFiber: 0, saturatedFat: 0 },
            { name: "spiring roll", calories: 170, protein: 5, fat: 5, carb: 26, dietryFiber: 3, saturatedFat: 0.5 }
        ];

        // Icons as inline SVG components
        const Plus = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Edit2 = ({ size = 18 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Check = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const X = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Database = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
            </svg>
        );

        const TrendingUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const History = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 3v5h5"></path>
                <path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path>
                <path d="M12 7v5l4 2"></path>
            </svg>
        );

        const RefreshCw = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        function MacroTracker() {
            const [foodDatabase, setFoodDatabase] = useState([]);
            const [allSessions, setAllSessions] = useState([]);
            const [currentSessionId, setCurrentSessionId] = useState(null);
            const [showAddFood, setShowAddFood] = useState(false);
            const [showAddEntry, setShowAddEntry] = useState(false);
            const [editingFood, setEditingFood] = useState(null);
            const [view, setView] = useState('tracker');
            const [loading, setLoading] = useState(true);
            const [showNewSessionModal, setShowNewSessionModal] = useState(false);
            const [newSessionName, setNewSessionName] = useState('');

            const [newFood, setNewFood] = useState({
                name: '',
                calories: '',
                protein: '',
                fat: '',
                carb: '',
                dietryFiber: '',
                saturatedFat: ''
            });

            const [newEntry, setNewEntry] = useState({
                foodId: '',
                count: 1
            });

            useEffect(() => {
                loadData();
            }, []);

            const loadData = () => {
                setLoading(true);
                try {
                    const dbData = localStorage.getItem('food-database');
                    if (dbData) {
                        setFoodDatabase(JSON.parse(dbData));
                    } else {
                        // First time user - load starter foods
                        const starterFoods = STARTER_FOODS.map((food, index) => ({
                            ...food,
                            id: `starter-${Date.now()}-${index}`
                        }));
                        setFoodDatabase(starterFoods);
                        saveDatabase(starterFoods);
                    }

                    const sessionsData = localStorage.getItem('tracking-sessions');
                    if (sessionsData) {
                        const sessions = JSON.parse(sessionsData);
                        setAllSessions(sessions);
                        
                        if (sessions.length > 0) {
                            setCurrentSessionId(sessions[0].id);
                        }
                    } else {
                        createNewSession('First Session', true);
                    }
                } catch (error) {
                    console.log('No existing data, starting fresh');
                    const starterFoods = STARTER_FOODS.map((food, index) => ({
                        ...food,
                        id: `starter-${Date.now()}-${index}`
                    }));
                    setFoodDatabase(starterFoods);
                    saveDatabase(starterFoods);
                    createNewSession('First Session', true);
                }
                setLoading(false);
            };

            const createNewSession = (name = '', skipModal = false) => {
                const sessionName = name || newSessionName || `Session ${new Date().toLocaleString()}`;
                const newSession = {
                    id: Date.now().toString(),
                    name: sessionName,
                    date: new Date().toISOString(),
                    log: []
                };

                const updatedSessions = [newSession, ...allSessions];
                setAllSessions(updatedSessions);
                setCurrentSessionId(newSession.id);
                saveSessions(updatedSessions);
                
                if (!skipModal) {
                    setShowNewSessionModal(false);
                    setNewSessionName('');
                }
            };

            const saveSessions = (sessions) => {
                try {
                    localStorage.setItem('tracking-sessions', JSON.stringify(sessions));
                } catch (error) {
                    console.error('Error saving sessions:', error);
                }
            };

            const saveDatabase = (db) => {
                try {
                    localStorage.setItem('food-database', JSON.stringify(db));
                } catch (error) {
                    console.error('Error saving database:', error);
                }
            };

            const getCurrentSession = () => {
                return allSessions.find(s => s.id === currentSessionId);
            };

            const updateCurrentSession = (updatedLog) => {
                const updatedSessions = allSessions.map(s => 
                    s.id === currentSessionId ? { ...s, log: updatedLog } : s
                );
                setAllSessions(updatedSessions);
                saveSessions(updatedSessions);
            };

            const deleteSession = (sessionId) => {
                const updatedSessions = allSessions.filter(s => s.id !== sessionId);
                setAllSessions(updatedSessions);
                saveSessions(updatedSessions);
                
                if (sessionId === currentSessionId && updatedSessions.length > 0) {
                    setCurrentSessionId(updatedSessions[0].id);
                }
            };

            const exportData = () => {
                const data = {
                    foodDatabase,
                    sessions: allSessions
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `macro-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const exportFoodDatabase = () => {
                const data = {
                    foodDatabase: foodDatabase,
                    libraryName: "My Food Library",
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `food-library-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const importData = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.foodDatabase) {
                                setFoodDatabase(data.foodDatabase);
                                saveDatabase(data.foodDatabase);
                            }
                            if (data.sessions) {
                                setAllSessions(data.sessions);
                                saveSessions(data.sessions);
                                if (data.sessions.length > 0) {
                                    setCurrentSessionId(data.sessions[0].id);
                                }
                            }
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data. Please check the file.');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            };

            const importFoodLibrary = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.foodDatabase && Array.isArray(data.foodDatabase)) {
                                // Add imported foods to existing database (avoid duplicates by name)
                                const existingNames = new Set(foodDatabase.map(f => f.name.toLowerCase()));
                                const newFoods = data.foodDatabase
                                    .filter(f => !existingNames.has(f.name.toLowerCase()))
                                    .map(food => ({
                                        ...food,
                                        id: `imported-${Date.now()}-${Math.random()}`
                                    }));
                                
                                const updatedDb = [...foodDatabase, ...newFoods];
                                setFoodDatabase(updatedDb);
                                saveDatabase(updatedDb);
                                alert(`Imported ${newFoods.length} new foods! (Duplicates skipped)`);
                            } else {
                                alert('Invalid food library format.');
                            }
                        } catch (error) {
                            alert('Error importing food library. Please check the file.');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            };

            const addFood = () => {
                if (!newFood.name || !newFood.calories) return;

                const food = {
                    id: Date.now().toString(),
                    name: newFood.name,
                    calories: parseFloat(newFood.calories) || 0,
                    protein: parseFloat(newFood.protein) || 0,
                    fat: parseFloat(newFood.fat) || 0,
                    carb: parseFloat(newFood.carb) || 0,
                    dietryFiber: parseFloat(newFood.dietryFiber) || 0,
                    saturatedFat: parseFloat(newFood.saturatedFat) || 0
                };

                const updatedDb = [...foodDatabase, food];
                setFoodDatabase(updatedDb);
                saveDatabase(updatedDb);

                setNewFood({
                    name: '',
                    calories: '',
                    protein: '',
                    fat: '',
                    carb: '',
                    dietryFiber: '',
                    saturatedFat: ''
                });
                setShowAddFood(false);
            };

            const updateFood = () => {
                if (!editingFood) return;

                const updatedDb = foodDatabase.map(f => 
                    f.id === editingFood.id ? editingFood : f
                );
                setFoodDatabase(updatedDb);
                saveDatabase(updatedDb);
                setEditingFood(null);
            };

            const deleteFood = (id) => {
                const updatedDb = foodDatabase.filter(f => f.id !== id);
                setFoodDatabase(updatedDb);
                saveDatabase(updatedDb);
            };

            const addEntry = () => {
                if (!newEntry.foodId) return;

                const entry = {
                    id: Date.now().toString(),
                    foodId: newEntry.foodId,
                    count: parseFloat(newEntry.count) || 1,
                    timestamp: new Date().toISOString()
                };

                const currentSession = getCurrentSession();
                const updatedLog = [...(currentSession?.log || []), entry];
                updateCurrentSession(updatedLog);

                setNewEntry({ foodId: '', count: 1 });
                setShowAddEntry(false);
            };

            const deleteEntry = (id) => {
                const currentSession = getCurrentSession();
                const updatedLog = (currentSession?.log || []).filter(e => e.id !== id);
                updateCurrentSession(updatedLog);
            };

            const calculateTotals = (log) => {
                const totals = {
                    calories: 0,
                    protein: 0,
                    fat: 0,
                    carb: 0,
                    dietryFiber: 0,
                    saturatedFat: 0
                };

                (log || []).forEach(entry => {
                    const food = foodDatabase.find(f => f.id === entry.foodId);
                    if (food) {
                        totals.calories += food.calories * entry.count;
                        totals.protein += food.protein * entry.count;
                        totals.fat += food.fat * entry.count;
                        totals.carb += food.carb * entry.count;
                        totals.dietryFiber += food.dietryFiber * entry.count;
                        totals.saturatedFat += food.saturatedFat * entry.count;
                    }
                });

                return totals;
            };

            const currentSession = getCurrentSession();
            const totals = calculateTotals(currentSession?.log);

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center justify-center">
                        <div className="text-gray-600">Loading...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 pb-20">
                    <div className="max-w-5xl mx-auto animate-in">
                        {/* Clean professional header */}
                        <div className="bg-white rounded-xl card-shadow-lg p-8 mb-6 border border-gray-100">
                            <h1 className="text-3xl font-bold text-gray-900 mb-1">
                                Macro Tracker
                            </h1>
                            <p className="text-gray-500 text-sm font-medium">{new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>

                        {/* Export/Import Section - clean and minimal */}
                        <div className="bg-white rounded-xl card-shadow p-5 mb-6 border border-gray-100">
                            <div className="grid grid-cols-2 gap-3 mb-3">
                                <button
                                    onClick={exportData}
                                    className="bg-gray-900 text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition-colors text-sm"
                                >
                                    ðŸ“¥ Export All Data
                                </button>
                                <button
                                    onClick={importData}
                                    className="bg-gray-900 text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition-colors text-sm"
                                >
                                    ðŸ“¤ Import All Data
                                </button>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <button
                                    onClick={exportFoodDatabase}
                                    className="border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors text-sm flex items-center justify-center gap-2"
                                >
                                    <Download />
                                    Export Library
                                </button>
                                <button
                                    onClick={importFoodLibrary}
                                    className="border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-colors text-sm flex items-center justify-center gap-2"
                                >
                                    <Plus />
                                    Import Library
                                </button>
                            </div>
                        </div>

                        {/* Navigation tabs - professional style */}
                        <div className="flex gap-2 mb-6">
                            <button
                                onClick={() => setView('tracker')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                    view === 'tracker'
                                        ? 'bg-gray-900 text-white card-shadow-lg'
                                        : 'bg-white text-gray-600 hover:bg-gray-50 card-shadow border border-gray-200'
                                }`}
                            >
                                <span className="inline-flex items-center gap-2">
                                    <TrendingUp />
                                    Tracker
                                </span>
                            </button>
                            <button
                                onClick={() => setView('history')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                    view === 'history'
                                        ? 'bg-gray-900 text-white card-shadow-lg'
                                        : 'bg-white text-gray-600 hover:bg-gray-50 card-shadow border border-gray-200'
                                }`}
                            >
                                <span className="inline-flex items-center gap-2">
                                    <History />
                                    History
                                </span>
                            </button>
                            <button
                                onClick={() => setView('database')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                    view === 'database'
                                        ? 'bg-gray-900 text-white card-shadow-lg'
                                        : 'bg-white text-gray-600 hover:bg-gray-50 card-shadow border border-gray-200'
                                }`}
                            >
                                <span className="inline-flex items-center gap-2">
                                    <Database />
                                    Database
                                </span>
                            </button>
                        </div>

                        {view === 'tracker' && (
                            <>
                                <div className="bg-white rounded-2xl shadow-lg p-4 mb-6">
                                    <div className="flex items-center justify-between">
                                        <div className="flex-1">
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Current Session</label>
                                            <select
                                                value={currentSessionId || ''}
                                                onChange={(e) => setCurrentSessionId(e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                            >
                                                {allSessions.map(session => (
                                                    <option key={session.id} value={session.id}>
                                                        {session.name} - {new Date(session.date).toLocaleString()}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        <button
                                            onClick={() => setShowNewSessionModal(true)}
                                            className="ml-4 bg-green-600 text-white p-3 rounded-xl hover:bg-green-700 transition-colors"
                                            title="Start New Session"
                                        >
                                            <RefreshCw />
                                        </button>
                                    </div>
                                </div>

                                {showNewSessionModal && (
                                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                        <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full">
                                            <h3 className="text-xl font-bold text-gray-800 mb-4">Start New Session</h3>
                                            <input
                                                type="text"
                                                placeholder="Session name (optional)"
                                                value={newSessionName}
                                                onChange={(e) => setNewSessionName(e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none mb-4"
                                            />
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => createNewSession()}
                                                    className="flex-1 bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors"
                                                >
                                                    Create
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setShowNewSessionModal(false);
                                                        setNewSessionName('');
                                                    }}
                                                    className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="glass rounded-3xl shadow-xl p-6 mb-6">
                                    <h2 className="text-2xl font-black text-gray-800 mb-6 flex items-center gap-2">
                                        <span className="text-3xl">ðŸ’ª</span>
                                        Current Totals
                                    </h2>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        <div className="bg-gradient-to-br from-red-500 to-pink-600 p-5 rounded-2xl shadow-lg transform hover:scale-105 transition-transform">
                                            <div className="text-sm text-white font-bold opacity-90">Calories</div>
                                            <div className="text-3xl font-black text-white">{totals.calories.toFixed(0)}</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-blue-500 to-cyan-600 p-5 rounded-2xl shadow-lg transform hover:scale-105 transition-transform">
                                            <div className="text-sm text-white font-bold opacity-90">Protein</div>
                                            <div className="text-3xl font-black text-white">{totals.protein.toFixed(1)}g</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-yellow-500 to-orange-600 p-5 rounded-2xl shadow-lg transform hover:scale-105 transition-transform">
                                            <div className="text-sm text-white font-bold opacity-90">Fat</div>
                                            <div className="text-3xl font-black text-white">{totals.fat.toFixed(1)}g</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-green-500 to-emerald-600 p-5 rounded-2xl shadow-lg transform hover:scale-105 transition-transform">
                                            <div className="text-sm text-white font-bold opacity-90">Carbs</div>
                                            <div className="text-3xl font-black text-white">{totals.carb.toFixed(1)}g</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-purple-500 to-violet-600 p-5 rounded-2xl shadow-lg transform hover:scale-105 transition-transform">
                                            <div className="text-sm text-white font-bold opacity-90">Fiber</div>
                                            <div className="text-3xl font-black text-white">{totals.dietryFiber.toFixed(1)}g</div>
                                        </div>
                                        <div className="bg-gradient-to-br from-orange-500 to-red-600 p-5 rounded-2xl shadow-lg transform hover:scale-105 transition-transform">
                                            <div className="text-sm text-white font-bold opacity-90">Sat Fat</div>
                                            <div className="text-3xl font-black text-white">{totals.saturatedFat.toFixed(1)}g</div>
                                        </div>
                                    </div>
                                </div>

                                <button
                                    onClick={() => setShowAddEntry(true)}
                                    className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-5 rounded-2xl font-black shadow-2xl hover:shadow-3xl transition-all transform hover:scale-105 mb-6 flex items-center justify-center gap-3 text-lg glow"
                                >
                                    <Plus />
                                    Log Food
                                </button>

                                {showAddEntry && (
                                    <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                                        <h3 className="text-lg font-bold text-gray-800 mb-4">Log Food Entry</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Select Food</label>
                                                <select
                                                    value={newEntry.foodId}
                                                    onChange={(e) => setNewEntry({ ...newEntry, foodId: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                >
                                                    <option value="">Choose a food...</option>
                                                    {foodDatabase.map(food => (
                                                        <option key={food.id} value={food.id}>{food.name}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Servings</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEntry.count}
                                                    onChange={(e) => setNewEntry({ ...newEntry, count: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={addEntry}
                                                    className="flex-1 bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                                                >
                                                    <Check />
                                                    Add
                                                </button>
                                                <button
                                                    onClick={() => setShowAddEntry(false)}
                                                    className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center gap-2"
                                                >
                                                    <X />
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <h3 className="text-lg font-bold text-gray-800 mb-4">Current Log</h3>
                                    {!currentSession?.log || currentSession.log.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">No entries yet. Start logging!</p>
                                    ) : (
                                        <div className="space-y-3">
                                            {currentSession.log.map(entry => {
                                                const food = foodDatabase.find(f => f.id === entry.foodId);
                                                if (!food) return null;
                                                return (
                                                    <div key={entry.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                                                        <div>
                                                            <div className="font-semibold text-gray-800">{food.name}</div>
                                                            <div className="text-sm text-gray-600">
                                                                {entry.count}x serving â€¢ {(food.calories * entry.count).toFixed(0)} cal
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => deleteEntry(entry.id)}
                                                            className="text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {view === 'history' && (
                            <div className="bg-white rounded-2xl shadow-lg p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">All Sessions</h2>
                                {allSessions.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">No sessions yet. Start tracking!</p>
                                ) : (
                                    <div className="space-y-4">
                                        {allSessions.map(session => {
                                            const sessionTotals = calculateTotals(session.log);
                                            return (
                                                <div key={session.id} className="border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-colors">
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div>
                                                            <h3 className="font-bold text-gray-800">{session.name}</h3>
                                                            <p className="text-sm text-gray-600">{new Date(session.date).toLocaleString()}</p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => {
                                                                    setCurrentSessionId(session.id);
                                                                    setView('tracker');
                                                                }}
                                                                className="text-blue-600 hover:bg-blue-50 p-2 rounded-lg transition-colors text-sm font-semibold"
                                                            >
                                                                View
                                                            </button>
                                                            <button
                                                                onClick={() => {
                                                                    // Create CSV content
                                                                    let csv = 'Food,Servings,Calories,Protein (g),Fat (g),Carbs (g),Fiber (g),Sat Fat (g)\n';
                                                                    
                                                                    session.log.forEach(entry => {
                                                                        const food = foodDatabase.find(f => f.id === entry.foodId);
                                                                        if (food) {
                                                                            csv += `"${food.name}",${entry.count},${food.calories * entry.count},${food.protein * entry.count},${food.fat * entry.count},${food.carb * entry.count},${food.dietryFiber * entry.count},${food.saturatedFat * entry.count}\n`;
                                                                        }
                                                                    });
                                                                    
                                                                    // Add totals row
                                                                    const totals = calculateTotals(session.log);
                                                                    csv += `\nTOTALS,,${totals.calories.toFixed(1)},${totals.protein.toFixed(1)},${totals.fat.toFixed(1)},${totals.carb.toFixed(1)},${totals.dietryFiber.toFixed(1)},${totals.saturatedFat.toFixed(1)}\n`;
                                                                    
                                                                    // Download CSV
                                                                    const blob = new Blob([csv], { type: 'text/csv' });
                                                                    const url = URL.createObjectURL(blob);
                                                                    const a = document.createElement('a');
                                                                    a.href = url;
                                                                    a.download = `${session.name.replace(/\s+/g, '-')}-${new Date(session.date).toISOString().split('T')[0]}.csv`;
                                                                    a.click();
                                                                    URL.revokeObjectURL(url);
                                                                }}
                                                                className="text-green-600 hover:bg-green-50 p-2 rounded-lg transition-colors text-sm font-semibold"
                                                            >
                                                                CSV
                                                            </button>
                                                            <button
                                                                onClick={() => deleteSession(session.id)}
                                                                className="text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors"
                                                            >
                                                                <Trash2 size={18} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-3 gap-2 text-sm">
                                                        <div className="bg-red-50 p-2 rounded">
                                                            <div className="text-xs text-red-600">Calories</div>
                                                            <div className="font-bold text-red-700">{sessionTotals.calories.toFixed(0)}</div>
                                                        </div>
                                                        <div className="bg-blue-50 p-2 rounded">
                                                            <div className="text-xs text-blue-600">Protein</div>
                                                            <div className="font-bold text-blue-700">{sessionTotals.protein.toFixed(1)}g</div>
                                                        </div>
                                                        <div className="bg-yellow-50 p-2 rounded">
                                                            <div className="text-xs text-yellow-600">Fat</div>
                                                            <div className="font-bold text-yellow-700">{sessionTotals.fat.toFixed(1)}g</div>
                                                        </div>
                                                    </div>
                                                    <div className="mt-2 text-sm text-gray-600">
                                                        {session.log?.length || 0} entries
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'database' && (
                            <>
                                <button
                                    onClick={() => setShowAddFood(true)}
                                    className="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all mb-6 flex items-center justify-center gap-2"
                                >
                                    <Plus />
                                    Add New Food
                                </button>

                                {showAddFood && (
                                    <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                                        <h3 className="text-lg font-bold text-gray-800 mb-4">Add New Food</h3>
                                        <div className="space-y-4">
                                            <input
                                                type="text"
                                                placeholder="Food Name"
                                                value={newFood.name}
                                                onChange={(e) => setNewFood({ ...newFood, name: e.target.value })}
                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                            />
                                            <div className="grid grid-cols-2 gap-4">
                                                <input
                                                    type="number"
                                                    placeholder="Calories"
                                                    value={newFood.calories}
                                                    onChange={(e) => setNewFood({ ...newFood, calories: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Protein (g)"
                                                    value={newFood.protein}
                                                    onChange={(e) => setNewFood({ ...newFood, protein: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Fat (g)"
                                                    value={newFood.fat}
                                                    onChange={(e) => setNewFood({ ...newFood, fat: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Carbs (g)"
                                                    value={newFood.carb}
                                                    onChange={(e) => setNewFood({ ...newFood, carb: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Fiber (g)"
                                                    value={newFood.dietryFiber}
                                                    onChange={(e) => setNewFood({ ...newFood, dietryFiber: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Sat Fat (g)"
                                                    value={newFood.saturatedFat}
                                                    onChange={(e) => setNewFood({ ...newFood, saturatedFat: e.target.value })}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                />
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={addFood}
                                                    className="flex-1 bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                                                >
                                                    <Check />
                                                    Save
                                                </button>
                                                <button
                                                    onClick={() => setShowAddFood(false)}
                                                    className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center gap-2"
                                                >
                                                    <X />
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <h3 className="text-lg font-bold text-gray-800 mb-4">Food Database ({foodDatabase.length} items)</h3>
                                    {foodDatabase.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">No foods in database. Add your first food!</p>
                                    ) : (
                                        <div className="space-y-3">
                                            {foodDatabase.map(food => (
                                                <div key={food.id}>
                                                    {editingFood?.id === food.id ? (
                                                        <div className="p-4 bg-blue-50 rounded-xl space-y-3">
                                                            <input
                                                                type="text"
                                                                value={editingFood.name}
                                                                onChange={(e) => setEditingFood({ ...editingFood, name: e.target.value })}
                                                                className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                            />
                                                            <div className="grid grid-cols-3 gap-2 text-sm">
                                                                <input
                                                                    type="number"
                                                                    value={editingFood.calories}
                                                                    onChange={(e) => setEditingFood({ ...editingFood, calories: e.target.value })}
                                                                    placeholder="Cal"
                                                                    className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={editingFood.protein}
                                                                    onChange={(e) => setEditingFood({ ...editingFood, protein: e.target.value })}
                                                                    placeholder="Protein"
                                                                    className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={editingFood.fat}
                                                                    onChange={(e) => setEditingFood({ ...editingFood, fat: e.target.value })}
                                                                    placeholder="Fat"
                                                                    className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={editingFood.carb}
                                                                    onChange={(e) => setEditingFood({ ...editingFood, carb: e.target.value })}
                                                                    placeholder="Carbs"
                                                                    className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={editingFood.dietryFiber}
                                                                    onChange={(e) => setEditingFood({ ...editingFood, dietryFiber: e.target.value })}
                                                                    placeholder="Fiber"
                                                                    className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={editingFood.saturatedFat}
                                                                    onChange={(e) => setEditingFood({ ...editingFood, saturatedFat: e.target.value })}
                                                                    placeholder="Sat Fat"
                                                                    className="w-full p-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                                                />
                                                            </div>
                                                            <div className="flex gap-2">
                                                                <button
                                                                    onClick={updateFood}
                                                                    className="flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-1"
                                                                >
                                                                    <Check size={16} />
                                                                    Save
                                                                </button>
                                                                <button
                                                                    onClick={() => setEditingFood(null)}
                                                                    className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center gap-1"
                                                                >
                                                                    <X size={16} />
                                                                    Cancel
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="flex items-start justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors">
                                                            <div className="flex-1">
                                                                <div className="font-semibold text-gray-800 mb-1">{food.name}</div>
                                                                <div className="text-sm text-gray-600 flex flex-wrap gap-x-3 gap-y-1">
                                                                    <span>{food.calories} cal</span>
                                                                    <span>P: {food.protein}g</span>
                                                                    <span>F: {food.fat}g</span>
                                                                    <span>C: {food.carb}g</span>
                                                                    {food.dietryFiber > 0 && <span>Fiber: {food.dietryFiber}g</span>}
                                                                    {food.saturatedFat > 0 && <span>Sat: {food.saturatedFat}g</span>}
                                                                </div>
                                                            </div>
                                                            <div className="flex gap-2 ml-4">
                                                                <button
                                                                    onClick={() => setEditingFood(food)}
                                                                    className="text-blue-600 hover:bg-blue-50 p-2 rounded-lg transition-colors"
                                                                >
                                                                    <Edit2 />
                                                                </button>
                                                                <button
                                                                    onClick={() => deleteFood(food.id)}
                                                                    className="text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors"
                                                                >
                                                                    <Trash2 />
                                                                </button>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MacroTracker />, document.getElementById('root'));
    </script>
</body>
</html>